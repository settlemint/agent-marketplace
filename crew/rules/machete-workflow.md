---
description: Git machete workflow patterns for stacked PRs
globs: "**/commands/git/**/*.md"
alwaysApply: true
---

# Machete Workflow Patterns

## Sync Before Changes

**If machete-managed, sync with parent FIRST:**

```bash
git fetch origin
git machete update    # Rebase onto parent (safe in worktrees)
```

Run this before committing, pushing, or any operation that modifies history.

## Push Safety

Never `--force` unless explicitly requested. If push rejected:

1. `git pull --rebase` first, then retry
2. If machete-managed: `git push --force-with-lease`

## PR Update After Push

After successful push, update PR annotations:

```javascript
Skill({ skill: "crew:git:pr:update" });
```

## Marker Preservation

**NEVER remove or modify content between machete markers:**

```markdown
<!-- start git-machete generated -->

...stack chain content...

<!-- end git-machete generated -->
```

These markers are auto-generated by `git machete github anno-prs`.

## Navigation Commands

| Command               | Action                   |
| --------------------- | ------------------------ |
| `git machete go up`   | Move to parent branch    |
| `git machete go down` | Move to first child      |
| `git machete go next` | Move to next sibling     |
| `git machete go prev` | Move to previous sibling |
| `git machete status`  | Show stack visualization |

## Stack Management

| Command                           | Action                                |
| --------------------------------- | ------------------------------------- |
| `git machete add`                 | Add current branch to stack           |
| `git machete add --onto <parent>` | Add with explicit parent              |
| `git machete slide-out`           | Remove branch, reconnect children     |
| `git machete advance`             | Fast-forward merge child into current |

## PR Commands

| Command                                               | Action                           |
| ----------------------------------------------------- | -------------------------------- |
| `git machete github create-pr`                        | Create PR for current branch     |
| `git machete github anno-prs`                         | Annotate all PRs with stack info |
| `git machete github update-pr-descriptions --related` | Update all related PRs           |
