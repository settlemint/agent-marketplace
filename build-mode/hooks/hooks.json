{
  "description": "Build-mode quality gates: TDD reminders, CI validation, and progress preservation",
  "hooks": {
    "UserPromptSubmit": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Analyze the user's message. If it involves implementing code, modifying functionality, fixing bugs, or adding features to code files (*.ts, *.tsx, *.js, *.jsx, *.py, *.go, *.rs, etc.):\n\nReturn JSON with:\n- \"continue\": true\n- \"systemMessage\": \"<tdd-workflow>\\n## TDD Required\\n\\nBefore editing any code file, follow RED-GREEN-REFACTOR:\\n1. Write a failing test first\\n2. Run tests to confirm failure (for the RIGHT reason)\\n3. Write minimal code to pass\\n4. Run tests to confirm pass\\n\\nTest files (*.test.ts, *.spec.ts) can always be edited.\\nConfig/docs (*.json, *.md, *.yaml) skip TDD.\\n</tdd-workflow>\"\n\nIf the message is NOT about implementation (questions, research, planning), return only:\n- \"continue\": true\n\nAlways approve.",
            "timeout": 5
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "TDD Gate for Write/Edit operations.\n\n## Step 1: Check file type\nIf the file path matches ANY of these patterns, return {\"decision\": \"approve\"} immediately:\n- Documentation: *.md, *.txt, *.rst\n- Config files: *.json, *.yaml, *.yml, *.toml, *.config.*, .*, package.json, tsconfig.json\n- Styles: *.css, *.scss, *.less\n- Markup: *.html, *.svg\n- Plan files: any path containing .claude/plans/\n- Lock files: *.lock, *-lock.json\n\n## Step 2: Check if it's a TEST file\nIf the file being edited IS a test file (matches any of: *.test.ts, *.spec.ts, *.test.js, *.spec.js, *.test.tsx, *.spec.tsx, *_test.py, *_test.go, *_test.rs, test_*.py, *_spec.rb), return {\"decision\": \"approve\"} - writing tests is always encouraged.\n\n## Step 3: For implementation code files\nLook at the CONVERSATION CONTEXT for evidence of TDD workflow:\n- Was a test file recently written or edited for this feature/function?\n- Was 'bun test', 'npm test', 'vitest', 'jest', 'pytest', 'go test', 'cargo test' or similar run recently?\n- Did test output show failures related to what's being implemented?\n- Is this a fix for a failing test that was just run?\n\nIf YES to any of these: return {\"decision\": \"approve\"} - TDD workflow is being followed.\n\nIf NO evidence of tests in conversation for this code:\nReturn {\"decision\": \"block\", \"reason\": \"TDD Required: No test evidence found for this code. Write a failing test first, run it to see it fail, then implement the code to make it pass.\"}",
            "timeout": 10
          }
        ]
      }
    ],
    "Stop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Completion Gate: Before stopping, verify: 1) All tests pass (evidence required), 2) Lint is clean, 3) No TODO items remaining for current task, 4) Self-review checklist completed. If any verification is missing, the agent should continue and address those items. If all verifications pass, the agent should stop.",
            "timeout": 15
          }
        ]
      }
    ],
    "PreCompact": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "bash ${CLAUDE_PLUGIN_ROOT}/hooks/scripts/preserve-progress.sh",
            "timeout": 10
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "bash ${CLAUDE_PLUGIN_ROOT}/hooks/scripts/ci-gate.sh",
            "timeout": 120
          }
        ]
      }
    ]
  }
}
