{
  "description": "Enhanced planning workflow hooks - orchestrates multi-phase planning with Linear integration",
  "hooks": {
    "SessionStart": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "If this session involves planning (plan mode active, user mentions planning/design/spec/breakdown), apply the 7-phase planning methodology from the planning-methodology skill. Phases: Context Gathering → Clarifying Questions → Specification → Architecture → Task Decomposition → Validation → Documentation & Linear. Phase 7 Linear integration question is MANDATORY.",
            "timeout": 3
          }
        ]
      }
    ],
    "UserPromptSubmit": [
      {
        "matcher": "(?i)(plan mode|planning|create.*plan|design.*implementation|break.*down|write.*spec|feature.*plan)",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Planning context detected. Execute the 7-phase planning methodology:\n\n1. **Context Gathering** - Use context-researcher agent with 4-phase structured exploration\n2. **Clarifying Questions** - Use AskUserQuestion for edge cases, scope, requirements BEFORE designing\n3. **Specification & Analysis** - Six Core Areas checklist, three-tier boundaries (Always/Ask/Never)\n4. **Architecture Decision** - Use architecture-analyst agent, compare options, ADR format\n5. **Task Decomposition** - Use task-decomposer agent for 2-5 min tasks with parallelization markers\n6. **Validation** - Use plan-validator agent with confidence filtering (≥80%), Rule of Five\n7. **Documentation & Linear** - Persist plan to file, MUST ask about Linear integration\n\n**CRITICAL:** You MUST use AskUserQuestion to ask about Linear integration before completing. This is non-negotiable.",
            "timeout": 5
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "EnterPlanMode",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "The user is entering plan mode. Enhance this planning session by loading the planning-methodology skill and following the 7-phase planning process:\n\n1. **Context Gathering** - Use context-researcher agent with structured exploration (4 phases)\n2. **Clarifying Questions** - Ask about edge cases, error handling, scope BEFORE designing\n3. **Specification & Analysis** - Six Core Areas checklist, boundaries\n4. **Architecture Decision** - Use architecture-analyst agent, apply clean implementation principle\n5. **Task Decomposition** - Use task-decomposer agent for 2-5 minute tasks with evidence\n6. **Validation** - Use plan-validator agent with confidence filtering (≥80%)\n7. **Documentation** - Persist plan and offer Linear integration\n\nReturn a systemMessage reminding to follow this enhanced workflow. Return 'approve' to continue.",
            "timeout": 10
          }
        ]
      }
    ],
    "Stop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Check if this session involved planning (plan mode, feature planning, task breakdown). If YES and a plan was created:\n\n1. Check if Linear integration was offered via AskUserQuestion with these options:\n   - Option 1: Create new Linear ticket with the plan\n   - Option 2: Update existing Linear ticket (user provides ID)\n   - Option 3: Skip Linear integration\n\n2. If Linear was already offered OR this wasn't a planning session, the agent should stop.\n\n3. If planning occurred but Linear wasn't offered, the agent should continue to offer Linear integration.",
            "timeout": 15
          }
        ]
      }
    ]
  }
}
