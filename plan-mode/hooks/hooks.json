{
  "description": "Enhanced planning workflow hooks - orchestrates multi-phase planning with Linear integration",
  "hooks": {
    "SessionStart": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "If this session involves planning (plan mode active, user mentions planning/design/spec/breakdown), apply the 7-phase planning methodology from the planning-methodology skill. Phases: Context Gathering → Clarifying Questions → Specification → Architecture → Task Decomposition → Validation → Documentation & Linear. Phase 7 Linear integration question is MANDATORY. If this is NOT a planning session (e.g., debugging, troubleshooting, quick fixes, code review, general questions), simply approve and continue without any additional guidance.",
            "timeout": 3
          }
        ]
      }
    ],
    "UserPromptSubmit": [
      {
        "matcher": "(?i)(plan mode|planning|create.*plan|design.*implementation|break.*down|write.*spec|feature.*plan)",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Evaluate if this is truly a planning task. If this is debugging, troubleshooting, bug fixes, runtime errors, quick questions, or any non-planning work, return 'approve' immediately.\n\nOnly if this IS a genuine planning task, provide guidance to execute the 7-phase planning methodology:\n\n1. **Context Gathering** - Use context-researcher agent with 4-phase structured exploration\n2. **Clarifying Questions** - Use AskUserQuestion for edge cases, scope, requirements BEFORE designing\n3. **Specification & Analysis** - Six Core Areas checklist, three-tier boundaries (Always/Ask/Never)\n4. **Architecture Decision** - Use architecture-analyst agent, compare options, ADR format\n5. **Task Decomposition** - Use task-decomposer agent for 2-5 min tasks with parallelization markers\n6. **Validation** - Use plan-validator agent with confidence filtering (≥80%), Rule of Five\n7. **Documentation & Linear** - Persist plan to file, MUST ask about Linear integration\n\n**CRITICAL:** You MUST use AskUserQuestion to ask about Linear integration before completing. This is non-negotiable.",
            "timeout": 5
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "EnterPlanMode",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "The user is entering plan mode. Return 'approve' to continue, with a systemMessage reminding to follow the 7-phase planning process:\n\n1. **Context Gathering** - Use context-researcher agent with structured exploration (4 phases)\n2. **Clarifying Questions** - Ask about edge cases, error handling, scope BEFORE designing\n3. **Specification & Analysis** - Six Core Areas checklist, boundaries\n4. **Architecture Decision** - Use architecture-analyst agent, apply clean implementation principle\n5. **Task Decomposition** - Use task-decomposer agent for 2-5 minute tasks with evidence\n6. **Validation** - Use plan-validator agent with confidence filtering (≥80%)\n7. **Documentation** - Persist plan and offer Linear integration\n\nAlways return 'approve' - never block entering plan mode.",
            "timeout": 10
          }
        ]
      }
    ],
    "Stop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Check if this session involved planning (plan mode, feature planning, task breakdown). If this was NOT a planning session, return {\"continue\": false} to allow stopping.\n\nIf YES and a plan was created, check if Linear integration was offered. If Linear was already offered, return {\"continue\": false}. If planning occurred but Linear wasn't offered, return {\"continue\": true, \"systemMessage\": \"Remember to offer Linear integration before completing.\"}",
            "timeout": 15
          }
        ]
      }
    ]
  }
}
