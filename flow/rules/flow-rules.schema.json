{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Flow Rules Schema",
  "description": "Schema for flow plugin pattern matching rules",
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "version": {
      "type": "string",
      "description": "Rules file version"
    },
    "description": {
      "type": "string",
      "description": "Description of this rules file"
    },
    "config": {
      "type": "object",
      "description": "Global configuration",
      "properties": {
        "minConfidenceScore": {
          "type": "integer",
          "description": "Minimum score to suggest a skill",
          "minimum": 1,
          "maximum": 10
        },
        "showMatchReasons": {
          "type": "boolean",
          "description": "Whether to show why a skill was matched"
        },
        "maxSkillsToShow": {
          "type": "integer",
          "description": "Maximum number of skills to suggest",
          "minimum": 1,
          "maximum": 10
        }
      },
      "required": ["minConfidenceScore"]
    },
    "scoring": {
      "type": "object",
      "description": "Scoring weights for different match types",
      "properties": {
        "keyword": {
          "type": "integer",
          "description": "Weight for keyword matches"
        },
        "keywordPattern": {
          "type": "integer",
          "description": "Weight for keyword pattern matches"
        },
        "pathPattern": {
          "type": "integer",
          "description": "Weight for file path pattern matches"
        },
        "directoryMatch": {
          "type": "integer",
          "description": "Weight for directory matches"
        },
        "intentPattern": {
          "type": "integer",
          "description": "Weight for intent pattern matches"
        },
        "contentPattern": {
          "type": "integer",
          "description": "Weight for content pattern matches"
        },
        "contextPattern": {
          "type": "integer",
          "description": "Weight for context pattern matches"
        }
      }
    },
    "skills": {
      "type": "object",
      "description": "Skill definitions and their triggers",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "description": {
            "type": "string",
            "description": "Skill description"
          },
          "priority": {
            "type": "integer",
            "description": "Skill priority (higher = more important)",
            "minimum": 1,
            "maximum": 10
          },
          "triggers": {
            "type": "object",
            "description": "Trigger patterns for this skill",
            "properties": {
              "keywords": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Simple keyword matches"
              },
              "keywordPatterns": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Regex patterns for keywords"
              },
              "pathPatterns": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Glob patterns for file paths"
              },
              "intentPatterns": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Regex patterns for user intent"
              },
              "contentPatterns": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Regex patterns for file content"
              },
              "contextPatterns": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Regex patterns for context matching"
              }
            }
          },
          "excludePatterns": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Patterns that should NOT trigger this skill"
          },
          "relatedSkills": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Related skills to suggest"
          }
        },
        "required": ["description", "triggers"]
      }
    },
    "workflows": {
      "type": "object",
      "description": "Workflow triggers and templates",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "description": {
            "type": "string",
            "description": "Workflow description"
          },
          "trigger": {
            "type": "string",
            "description": "Regex pattern to trigger this workflow"
          },
          "template": {
            "type": "string",
            "description": "Template name to use"
          }
        },
        "required": ["description", "trigger", "template"]
      }
    }
  },
  "required": ["version", "skills"]
}
